apiVersion: eksctl.io/v1alpha5
kind: ClusterConfig
metadata:
  name: llm-inference-cluster
  region: ap-northeast-1
  version: "1.29"

iam:
  withOIDC: true

addons:
  - name: aws-fsx-csi-driver
    version: latest

managedNodeGroups:
  # 1. Gate Service 节点 (使用 Spot 实例省钱)
  - name: cpu-ng
    instanceTypes: 
      - t3.medium
      - t3a.medium  # 添加备选实例类型以提高 Spot 可用性
    desiredCapacity: 2
    minSize: 1
    maxSize: 3
    spot: true  # managedNodeGroups 支持 spot 字段

  # 2. LLM GPU 节点
  - name: gpu-ng
    instanceTypes:
      - g4dn.xlarge
    desiredCapacity: 1
    minSize: 0
    maxSize: 2
    availabilityZones: ["ap-northeast-1d"]
    labels: 
      nvidia.com/gpu: "true"
    
    iam:
      withAddonPolicies:
        fsx: true
    
    taints:
      - key: "nvidia.com/gpu"
        value: "true"
        effect: "NoSchedule"